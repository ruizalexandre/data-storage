function DataStorage(t){var e=t&&t.key||"root",a={},n={},r=0,i=t&&t.initialState||{},o=t&&t.syncWithStorage||void 0;if(o){var c=JSON.parse(o.getItem("DataStorage__"+e));c&&(i=c)}function u(){if(o){var t="DataStorage__"+e;o.removeItem(t),o.setItem(t,JSON.stringify(i))}}function s(t){return Object.freeze(t)}function f(t){if(t&&t.populate){var e={...s(i)};return Object.keys(n).forEach(function(t){e={...e,[n[t].key]:n[t].getData()}}),e}return s(i)}return u(),{key:e,appendStorage:function(t){if(n[t.key])throw"[DataStorage::append] A DataStorage with the key"+t.key+" already exists";n[t.key]=t},setData:function(t,e){i=t instanceof Function?e?t(f()):Object.assign({},i,t(f())):e?t:Object.assign({},i,t),Object.keys(a).forEach(function(t){a[t](s(i))}),u()},getData:f,selectData:function(t){return t instanceof Function?t(f()):f()[t]},selectStorage:function(t){return n[t]},subscribe:function(t){var n=r++;return a[n]=t,t(f()),{id:"DataStorage_"+e+"_subscriber_"+n,unsubscribe:function(){return delete a[n],!0}}}}}
